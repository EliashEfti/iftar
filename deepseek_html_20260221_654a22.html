<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>‡¶á‡¶´‡¶§‡¶æ‡¶∞¬∑‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø ¬∑ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶≤ elegance</title>
  <!-- ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶´‡¶®‡ßç‡¶ü (‡¶π‡¶ø‡¶®‡ßç‡¶¶ ‡¶∏‡¶ø‡¶≤‡¶ø‡¶ó‡ßÅ‡¶°‡¶º‡¶ø + ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- ‡¶≤‡¶ø‡¶´‡¶≤‡ßá‡¶ü ‡¶ì ‡¶´‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡¶ø‡¶¨‡¶ï‡ßç‡¶∏ -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #f9f6f2;  /* ‡¶â‡¶∑‡ßç‡¶Æ ‡¶ï‡ßç‡¶∞‡¶ø‡¶Æ */
      font-family: 'Inter', 'Hind Siliguri', sans-serif;
      padding: 1.5rem;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      color: #2d3e3a;
    }
    #app {
      max-width: 1200px;
      width: 100%;
    }
    /* ===== ‡¶è‡¶≤‡¶ø‡¶ó‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ===== */
    .elegant-header {
      background: #ffffff;
      border-radius: 32px;
      padding: 1.2rem 2.2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 30px rgba(0, 40, 20, 0.04);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      border: 1px solid #eae2d7;
    }
    .logo-elegant {
      font-size: 2.2rem;
      font-weight: 700;
      color: #2a5e49;
      letter-spacing: -0.3px;
      font-family: 'Hind Siliguri', sans-serif;
    }
    .pill-live {
      background: #e8f3ee;
      color: #1b6e51;
      padding: 0.5rem 1.8rem;
      border-radius: 60px;
      font-weight: 500;
      font-size: 1rem;
      border: 1px solid #c7e3d7;
    }
    /* ===== ‡¶∏‡¶´‡¶≤ ‡¶ü‡ßÅ‡¶≤‡¶¨‡¶æ‡¶∞ ===== */
    .soft-toolbar {
      background: white;
      border-radius: 60px;
      padding: 0.4rem 0.4rem 0.4rem 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 2rem;
      box-shadow: 0 6px 18px rgba(50, 60, 45, 0.04);
      border: 1px solid #dde9e2;
    }
    .soft-toolbar input {
      flex: 1 1 220px;
      background: #f9fcfb;
      border: 1px solid #cbdcd2;
      border-radius: 60px;
      padding: 0.9rem 1.5rem;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      color: #1f4237;
      outline: none;
    }
    .soft-toolbar input::placeholder { color: #98afa5; }
    .filter-elegant {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .filter-soft {
      background: #f4faf7;
      border: 1px solid #cde3da;
      color: #1c5341;
      padding: 0.6rem 1.6rem;
      border-radius: 50px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    .filter-soft.active {
      background: #2e6b55;
      border-color: #2e6b55;
      color: white;
    }
    /* ===== ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‚Äì ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶≤ ===== */
    .map-elegant {
      background: white;
      border-radius: 48px;
      padding: 1rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 10px 28px rgba(30, 50, 40, 0.02);
      border: 1px solid #d2e3db;
    }
    #map {
      height: 280px;
      border-radius: 36px;
      border: 1px solid #e5f0ea;
    }
    .map-footer-elegant {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    .locate-soft {
      background: #f5fbf8;
      border: 1px solid #b9d9cd;
      color: #1c5c45;
      padding: 0.6rem 2rem;
      border-radius: 60px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .stats-soft {
      background: #f9fefb;
      border: 1px solid #c6ded3;
      border-radius: 60px;
      padding: 0.5rem 2rem;
      color: #2d5f4b;
      font-weight: 500;
    }
    /* ===== ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‚Äì ‡¶è‡¶≤‡¶ø‡¶ó‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶≤ ===== */
    .locations-grid {
      display: flex;
      flex-direction: column;
      gap: 1.8rem;
      margin-bottom: 3rem;
    }
    .card-minimal {
      background: white;
      border-radius: 40px;
      padding: 2rem 2rem 1.6rem;
      box-shadow: 0 12px 35px -8px rgba(10, 30, 20, 0.06);
      border: 1px solid #e5f0ea;
      transition: 0.2s;
    }
    .card-minimal.verified {
      border-left: 18px solid #f2b05e;
      background: #fffdf9;
    }
    .verified-marker {
      background: #f2b05e;
      color: #2d3e2d;
      padding: 0.2rem 1.4rem;
      border-radius: 60px;
      display: inline-block;
      font-weight: 600;
      font-size: 0.8rem;
      letter-spacing: 0.3px;
      margin-bottom: 0.6rem;
      border: 1px solid #ec9f3f;
    }
    .card-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: baseline;
    }
    .name-bn {
      font-size: 2.2rem;
      font-weight: 700;
      color: #1c4e3c;
      font-family: 'Hind Siliguri', sans-serif;
    }
    .name-en {
      color: #5d8b78;
      background: #ecf6f1;
      padding: 0.2rem 1.3rem;
      border-radius: 40px;
      width: fit-content;
      font-size: 0.95rem;
      margin: 0.3rem 0;
    }
    .dist-soft {
      background: #ecf6f1;
      color: #186249;
      padding: 0.4rem 1.8rem;
      border-radius: 60px;
      font-weight: 500;
      border: 1px solid #bdd9cd;
    }
    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem 2.5rem;
      margin: 1rem 0 1rem;
    }
    .meta-soft {
      background: #f7fcf9;
      border: 1px solid #d1e8de;
      border-radius: 60px;
      padding: 0.3rem 1.4rem;
      display: flex;
      align-items: center;
      gap: 5px;
      color: #265f49;
    }
    .desc-soft {
      background: #fafdfb;
      border: 1px solid #d0e9de;
      border-radius: 28px;
      padding: 1.1rem 1.6rem;
      margin: 1rem 0 1rem;
      color: #2b4f40;
      font-size: 1rem;
    }
    .contact-photo-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 2rem;
      margin: 1.2rem 0;
    }
    .contact-soft {
      background: #eaf6f0;
      border: 1px solid #bad7ca;
      padding: 0.5rem 2rem;
      border-radius: 60px;
      font-weight: 500;
      color: #0e523b;
    }
    .photo-soft {
      width: 76px;
      height: 76px;
      border-radius: 28px;
      object-fit: cover;
      border: 2px solid #e1f0e8;
      background: #f1f9f4;
      cursor: pointer;
    }
    /* ‡¶≠‡ßã‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‚Äì ‡¶ï‡ßç‡¶≤‡¶ø‡¶® */
    .vote-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 2rem;
      border-top: 2px solid #e3f0ea;
      padding-top: 1.2rem;
    }
    .vote-num {
      background: #f2faf6;
      border: 1px solid #cbe3d9;
      border-radius: 60px;
      padding: 0.4rem 2rem;
      font-weight: 600;
      color: #1d644b;
    }
    .vote-actions {
      display: flex;
      gap: 1rem;
    }
    .vote-btn-soft {
      background: white;
      border: 2px solid #bcd9cd;
      color: #215f48;
      padding: 0.5rem 2rem;
      border-radius: 60px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.15s;
    }
    .vote-btn-soft.real:hover:not(:disabled) { background: #dcf5ea; border-color: #58b894; }
    .vote-btn-soft.fake:hover:not(:disabled) { background: #ffebeb; border-color: #e09898; color: #a13d3d; }
    .vote-btn-soft:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background: #f1f1f1;
      border-color: #c0c0c0;
    }
    .voted-soft {
      background: #e2efe9;
      color: #1d6049;
      padding: 0.3rem 1.3rem;
      border-radius: 60px;
      font-weight: 500;
      font-size: 0.9rem;
    }
    /* ===== ‡¶´‡¶∞‡ßç‡¶Æ ‚Äì ‡¶®‡¶∞‡¶Æ ===== */
    .form-soft {
      background: white;
      border-radius: 60px;
      padding: 2.5rem 2.2rem;
      box-shadow: 0 12px 40px -10px rgba(40, 60, 45, 0.06);
      border: 1px solid #e1eee7;
    }
    .form-title-soft {
      font-size: 2.2rem;
      font-weight: 700;
      color: #235d48;
      margin-bottom: 2rem;
      border-bottom: 2px solid #d6ebe1;
      display: inline-block;
    }
    .grid-soft {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
      gap: 1.5rem;
    }
    .field-soft label {
      font-weight: 600;
      color: #296a51;
      display: block;
      font-size: 0.95rem;
    }
    .field-soft input, .field-soft textarea {
      width: 100%;
      padding: 0.9rem 1.2rem;
      background: #f9fefb;
      border: 1px solid #d1e6dc;
      border-radius: 50px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
    }
    .submit-soft {
      background: #276e55;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 60px;
      font-weight: 600;
      font-size: 1.5rem;
      width: 100%;
      cursor: pointer;
      margin-top: 2rem;
      box-shadow: 0 6px 16px rgba(40, 100, 70, 0.15);
      transition: 0.15s;
    }
    .submit-soft:hover { background: #1e5b45; }
    .note-footer {
      text-align: center;
      margin-top: 1.2rem;
      color: #3b6f5a;
      font-weight: 400;
    }
  </style>
</head>
<body>
<div id="app">
  <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‚Äì ‡¶ï‡ßã‡¶® ‡¶ó‡ßç‡¶≤‡ßã ‡¶®‡ßá‡¶á -->
  <div class="elegant-header">
    <div class="logo-elegant">üçõ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ¬∑ ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø</div>
    <div class="pill-live">‚ö° ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡¶Æ‡¶ø‡¶â‡¶®‡¶ø‡¶ü‡¶ø</div>
  </div>

  <div class="soft-toolbar">
    <input type="text" id="searchField" placeholder="üîç ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
    <div class="filter-elegant">
      <span class="filter-soft active" id="filterAll">‡¶∏‡¶¨ üçΩÔ∏è</span>
      <span class="filter-soft" id="filterVerified">‚≠ê ‡¶∏‡¶§‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡¶ø‡¶§</span>
      <span class="filter-soft" id="filterNearby">üìç ‡¶ï‡¶æ‡¶õ‡ßá‡¶∞</span>
    </div>
  </div>

  <div class="map-elegant">
    <div id="map"></div>
    <div class="map-footer-elegant">
      <button class="locate-soft" id="locateBtn"><span>üìç</span> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®</button>
      <span class="stats-soft" id="mapStats">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
    </div>
  </div>

  <div id="locationsGrid" class="locations-grid"></div>

  <div class="form-soft">
    <div class="form-title-soft">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</div>
    <form id="addLocationForm">
      <div class="grid-soft">
        <div class="field-soft"><label>üç≤ ‡¶®‡¶æ‡¶Æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</label><input type="text" id="locNameBn" required></div>
        <div class="field-soft"><label>üá¨üáß Name (Eng)</label><input type="text" id="locNameEn"></div>
      </div>
      <div class="field-soft"><label>üìç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="locAddress" required></div>
      <div class="grid-soft">
        <div class="field-soft"><label>üìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="text" id="locDate" placeholder="‡ß®‡ß´ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö ‡ß®‡ß¶‡ß®‡ß´" required></div>
        <div class="field-soft"><label>‚è∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</label><input type="text" id="locTime" placeholder="‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ ‡ß≠:‡ß©‡ß¶" required></div>
      </div>
      <div class="field-soft"><label>üìù ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ</label><textarea id="locDesc" rows="2" required></textarea></div>
      <div class="grid-soft">
        <div class="field-soft"><label>üìû ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</label><input type="text" id="locContact" required></div>
        <div class="field-soft"><label>üñºÔ∏è ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï</label><input type="url" id="locPhoto"></div>
      </div>
      <div class="grid-soft">
        <div class="field-soft"><label>üó∫Ô∏è ‡¶Ö‡¶ï‡ßç‡¶∑‡¶æ‡¶Ç‡¶∂</label><input type="text" id="locLat" placeholder="23.8103"></div>
        <div class="field-soft"><label>üó∫Ô∏è ‡¶¶‡ßç‡¶∞‡¶æ‡¶ò‡¶ø‡¶Æ‡¶æ‡¶Ç‡¶∂</label><input type="text" id="locLng" placeholder="90.4125"></div>
      </div>
      <button type="submit" class="submit-soft">‚úÖ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </form>
    <div class="note-footer">‚ú® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤/‡¶´‡ßá‡¶ï ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
<script>
  (function() {
    const BIN_ID = '67b8a5d0e41b4d34e493d3b8';
    const API_KEY = '$2a$10$P.8d4hGXkF5zM6yJ7kLx8eNqW3sT1vR9bQ2cD4fH6jK1mN0pR5sT7vY';
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
    const PUT_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    let locations = [];
    let userLatLng = null;
    let map, userMarker;
    let activeFilter = 'all';

    const VOTE_KEY = 'iftar_votes_elegant';
    function getVoted() { return new Set(JSON.parse(localStorage.getItem(VOTE_KEY) || '[]')); }
    function addVote(id) { const s = getVoted(); s.add(id); localStorage.setItem(VOTE_KEY, JSON.stringify([...s])); }
    function hasVoted(id) { return getVoted().has(id); }

    function defaultLocations() {
      return [
        { id: 'e1', nameBn: '‡¶Ü‡¶≤-‡¶®‡ßÇ‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶', nameEn: 'Al-Noor', address: '‡ßß‡ß® ‡¶Æ‡ßá‡¶á‡¶® ‡¶∞‡ßã‡¶°, ‡¶¢‡¶æ‡¶ï‡¶æ', date: '‡ß®‡ß´ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', time: '‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ ‡ß≠:‡ß¶‡ß¶', description: '‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø, ‡¶™‡¶æ‡¶ï‡ßã‡¶°‡¶º‡¶æ, ‡¶ñ‡ßá‡¶ú‡ßÅ‡¶∞, ‡¶™‡¶æ‡¶®‡¶ø', contact: '‡ß¶‡ßß‡ßØxx-xxxxxx', photoUrl: 'https://images.unsplash.com/photo-1627308595171-d1b5d67126fd?w=100', lat: 23.8103, lng: 90.4125, votesReal: 18, votesFake: 2, verified: true },
        { id: 'e2', nameBn: '‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶®', nameEn: 'Biryani Foundation', address: '‡ß™‡ß™ ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∞‡ßã‡¶°', date: '‡ß®‡ß¨ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', time: '‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ ‡ß¨:‡ß™‡ß´', description: '‡¶ö‡¶ø‡¶ï‡ßá‡¶® ‡¶¨‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶®‡¶ø ‡¶ì ‡¶ú‡ßÅ‡¶∏', contact: '‡ß¶‡ß©‡ß¶‡ß¶-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', photoUrl: 'https://images.unsplash.com/photo-1631515243349-e0f75fcd8dcc?w=100', lat: 23.8041, lng: 90.4152, votesReal: 11, votesFake: 4, verified: false },
        { id: 'e3', nameBn: '‡¶ï‡¶Æ‡¶ø‡¶â‡¶®‡¶ø‡¶ü‡¶ø ‡¶ï‡¶ø‡¶ö‡ßá‡¶®', nameEn: 'Community Kitchen', address: '‡ßß‡ß≠ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶∞‡ßã‡¶°', date: '‡ß®‡ß´ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', time: '‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ ‡ß≠:‡ßß‡ß´', description: '‡¶ñ‡ßá‡¶ú‡ßÅ‡¶∞, ‡¶´‡ßç‡¶∞‡ßÅ‡¶ü ‡¶ö‡¶æ‡¶ü, ‡¶°‡¶æ‡¶≤', contact: 'community@example.com', photoUrl: '', lat: 23.7920, lng: 90.4088, votesReal: 5, votesFake: 1, verified: false },
        { id: 'e4', nameBn: '‡¶¶‡¶æ‡¶∞‡ßÅ‡¶∏ ‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ', nameEn: 'Dar-us-Salam', address: '‡ß≠‡ß®/‡¶è ‡¶¨‡ßá‡¶á‡¶≤‡¶ø ‡¶∞‡ßã‡¶°', date: '‡ß®‡ß¨ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', time: '‡ß≠:‡ßß‡ß¶ PM', description: '‡¶π‡¶æ‡¶≤‡¶ø‡¶Æ, ‡¶õ‡ßã‡¶≤‡¶æ, ‡¶ú‡¶ø‡¶≤‡¶æ‡¶™‡¶ø', contact: '‡ß¶‡ßß‡ß≠‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', photoUrl: 'https://images.unsplash.com/photo-1568909344668-6f5a5fe4a3b6?w=100', lat: 23.8172, lng: 90.4225, votesReal: 22, votesFake: 3, verified: true }
      ];
    }

    async function fetchLocations() {
      try {
        const res = await fetch(JSONBIN_URL, { headers: { 'X-Master-Key': API_KEY } });
        const data = await res.json();
        locations = data.record || [];
        if (!locations.length) locations = defaultLocations();
        renderMapMarkers();
        renderList();
        document.getElementById('mapStats').innerText = `üìç ${locations.length}‡¶ü‡¶ø ‡¶∏‡ßç‡¶™‡¶ü`;
      } catch (e) {
        locations = defaultLocations();
        renderMapMarkers();
        renderList();
      }
    }
    async function saveToBin() { try { await fetch(PUT_URL, { method:'PUT', headers:{'Content-Type':'application/json','X-Master-Key':API_KEY}, body:JSON.stringify(locations) }); } catch(e) {} }

    function initMap() {
      map = L.map('map').setView([23.8103, 90.4125], 12);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
    }
    function renderMapMarkers() {
      if (!map) return;
      map.eachLayer(l => { if (l instanceof L.Marker) map.removeLayer(l); });
      locations.forEach(loc => { if (loc.lat && loc.lng) L.marker([loc.lat, loc.lng]).addTo(map).bindPopup(loc.nameBn); });
    }

    document.getElementById('locateBtn').addEventListener('click', () => {
      navigator.geolocation.getCurrentPosition(pos => {
        userLatLng = [pos.coords.latitude, pos.coords.longitude];
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker(userLatLng, { icon: L.divIcon({ html: 'üìç', iconSize: [24,24] }) }).addTo(map);
        map.setView(userLatLng, 14);
        renderList();
      }, () => alert('‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡¶ø‡¶®'));
    });

    function getDistance(lat, lng) {
      if (!userLatLng) return null;
      const R = 6371; const dLat = (lat - userLatLng[0])*Math.PI/180; const dLng = (lng - userLatLng[1])*Math.PI/180;
      const a = Math.sin(dLat/2)**2 + Math.cos(userLatLng[0]*Math.PI/180)*Math.cos(lat*Math.PI/180)*Math.sin(dLng/2)**2;
      return (R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))).toFixed(1);
    }

    function renderList() {
      const searchTerm = document.getElementById('searchField').value.toLowerCase();
      let filtered = locations.filter(l => l.nameBn.toLowerCase().includes(searchTerm) || (l.nameEn && l.nameEn.toLowerCase().includes(searchTerm)) || l.address.toLowerCase().includes(searchTerm));
      if (activeFilter === 'verified') filtered = filtered.filter(l => l.verified);
      if (activeFilter === 'nearby' && userLatLng) filtered = filtered.filter(l => l.lat && l.lng).map(l => ({ ...l, dist: parseFloat(getDistance(l.lat, l.lng) || 999) })).sort((a,b) => a.dist - b.dist);

      const grid = document.getElementById('locationsGrid');
      if (!filtered.length) { grid.innerHTML = `<div style="background:white; border-radius:60px; padding:3rem; text-align:center; border:1px solid #d0e6db;">üçÉ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</div>`; return; }

      let html = '';
      filtered.forEach(loc => {
        const dist = (userLatLng && loc.lat && loc.lng) ? getDistance(loc.lat, loc.lng) : null;
        const distHtml = dist ? `<span class="dist-soft">üö∂ ${dist} ‡¶ï‡¶ø‡¶Æ‡¶ø</span>` : '';
        const verifiedMark = loc.verified ? '<div class="verified-marker">‚≠ê ‡¶∏‡¶§‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡¶ø‡¶§</div>' : '';
        const photoHtml = loc.photoUrl ? `<a href="${escapeHTML(loc.photoUrl)}" data-fancybox="gal-${loc.id}"><img src="${escapeHTML(loc.photoUrl)}" class="photo-soft"></a>` : '';
        const voted = hasVoted(loc.id);
        const realDisabled = voted ? 'disabled' : '';
        const fakeDisabled = voted ? 'disabled' : '';

        html += `
          <div class="card-minimal ${loc.verified?'verified':''}">
            ${verifiedMark}
            <div class="card-header"><span class="name-bn">${escapeHTML(loc.nameBn)}</span> ${distHtml}</div>
            ${loc.nameEn ? `<div class="name-en">${escapeHTML(loc.nameEn)}</div>` : ''}
            <div class="meta-row">
              <span class="meta-soft">üìç ${escapeHTML(loc.address)}</span>
              <span class="meta-soft">üìÖ ${escapeHTML(loc.date)} ¬∑ ${escapeHTML(loc.time)}</span>
            </div>
            <div class="desc-soft">üìù ${escapeHTML(loc.description)}</div>
            <div class="contact-photo-row">
              <span class="contact-soft">üìû ${escapeHTML(loc.contact)}</span>
              ${photoHtml}
            </div>
            <div class="vote-row">
              <span class="vote-num">üëç ${loc.votesReal}  üëé ${loc.votesFake}</span>
              <div class="vote-actions">
                <button class="vote-btn-soft real" data-id="${loc.id}" data-vote="real" ${realDisabled}>‚úì ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤</button>
                <button class="vote-btn-soft fake" data-id="${loc.id}" data-vote="fake" ${fakeDisabled}>‚úó ‡¶´‡ßá‡¶ï</button>
              </div>
              ${voted ? '<span class="voted-soft">‚úî ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®</span>' : ''}
            </div>
          </div>
        `;
      });
      grid.innerHTML = html;
      Fancybox.bind("[data-fancybox]");
      document.querySelectorAll('.vote-btn-soft:not(:disabled)').forEach(b => b.addEventListener('click', voteHandler));
    }

    function escapeHTML(s) { return String(s).replace(/[&<>]/g, c => ({ '&':'&amp;','<':'&lt;','>':'&gt;' }[c])); }

    async function voteHandler(e) {
      const btn = e.currentTarget;
      const id = btn.dataset.id;
      const vote = btn.dataset.vote;
      if (hasVoted(id)) { alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!'); renderList(); return; }
      const loc = locations.find(l => l.id === id);
      if (!loc) return;
      if (vote === 'real') loc.votesReal += 1; else loc.votesFake += 1;
      const total = loc.votesReal + loc.votesFake;
      if (total >= 3 && loc.votesReal > loc.votesFake * 2) loc.verified = true;
      else if (loc.votesFake > loc.votesReal * 2) loc.verified = false;
      addVote(id);
      await saveToBin();
      renderList();
    }

    document.getElementById('addLocationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const nameBn = document.getElementById('locNameBn').value.trim();
      const nameEn = document.getElementById('locNameEn').value.trim();
      const address = document.getElementById('locAddress').value.trim();
      const date = document.getElementById('locDate').value.trim() || '‡ß®‡ß´ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö';
      const time = document.getElementById('locTime').value.trim() || '‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ';
      const desc = document.getElementById('locDesc').value.trim();
      const contact = document.getElementById('locContact').value.trim();
      const photo = document.getElementById('locPhoto').value.trim();
      const lat = parseFloat(document.getElementById('locLat').value);
      const lng = parseFloat(document.getElementById('locLng').value);
      if (!nameBn || !address || !desc || !contact) { alert('‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï'); return; }
      const newLoc = {
        id: Date.now() + '-' + Math.random().toString(36).substring(2,8),
        nameBn, nameEn, address, date, time, description: desc, contact,
        photoUrl: photo || '',
        lat: isNaN(lat) ? undefined : lat,
        lng: isNaN(lng) ? undefined : lng,
        votesReal: 0, votesFake: 0, verified: false
      };
      locations.push(newLoc);
      await saveToBin();
      if (map && newLoc.lat && newLoc.lng) L.marker([newLoc.lat, newLoc.lng]).addTo(map).bindPopup(newLoc.nameBn);
      e.target.reset();
      renderList();
      alert('‚úÖ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶∏‡¶¨‡¶æ‡¶á ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡•§');
    });

    document.getElementById('filterAll').addEventListener('click', function() { activeFilter='all'; document.querySelectorAll('.filter-soft').forEach(c=>c.classList.remove('active')); this.classList.add('active'); renderList(); });
    document.getElementById('filterVerified').addEventListener('click', function() { activeFilter='verified'; document.querySelectorAll('.filter-soft').forEach(c=>c.classList.remove('active')); this.classList.add('active'); renderList(); });
    document.getElementById('filterNearby').addEventListener('click', function() { if(!userLatLng) { alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶¶‡¶ø‡¶®'); return; } activeFilter='nearby'; document.querySelectorAll('.filter-soft').forEach(c=>c.classList.remove('active')); this.classList.add('active'); renderList(); });
    document.getElementById('searchField').addEventListener('input', renderList);

    window.addEventListener('load', () => { initMap(); fetchLocations(); });
  })();
</script>
</body>
</html>